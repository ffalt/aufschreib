function Stats(a,b){function c(a,b,c,d){var e=a.selectAll(".legend"),f=16;e.empty()&&(a.append("g").attr("class","legend").append("svg:rect").attr("class","legend-background").attr("y",4).attr("opacity",.8).attr("fill","white"),e=a.selectAll(".legend")),e.select(".legend-background").attr("x",c-10).attr("width",d).attr("height",25*b.length+10);var g=e.selectAll(".legend-entry").data(b).enter().append("g").attr("class","legend-entry");g.append("svg:rect").attr("x",c).attr("y",function(a,b){return f+25*b}).attr("width",10).attr("height",10).attr("class","legend-color"),g.append("svg:text").attr("x",c+15).attr("y",function(a,b){return f+25*b+10}),e.selectAll("text").data(b).text(function(a){return a.name}),e.selectAll(".legend-color").data(b).attr("fill",function(a){return a.color}),e.selectAll(".legend-entry").data(b).exit().remove()}function d(a,c){var d={cmd:"json",type:a.type};a.mode&&(d.mode=a.mode),aufschreib.range.min&&(d.min=aufschreib.range.min.valueOf()),aufschreib.range.max&&(d.max=aufschreib.range.max.valueOf()),a.kind&&(d.kind=a.kind),a.forceregenerate&&(d.force=!0),aufschreib.getJson("#"+a.id+"vis",d,function(d){b||aufschreib.setStatsSilent(a.type,a.mode,a.kind,"all"===a.cat?null:a.cat),A=d,c()})}function e(a){d3.select("#"+a+"download-svg").on("click",l),d3.select("#"+a+"download-json").on("click",m),d3.select("#"+a+"current-json a").on("click",function(){p(a)})}function f(a,b){b.forEach(function(b){n(a,b)})}function g(a,b,c){b.forEach(function(b){q(a,b,c)})}function h(a,b,c){b.forEach(function(b){r(a,b,c)})}function i(a,b,c){b.forEach(function(b){s(a,b,c)})}function j(a,b,c){z=d3.select("#"+a+"vis").append("svg").attr("width",b).attr("height",c).attr("viewBox","0 0 "+b+" "+c).attr("perserveAspectRatio","xMinYMid").style("background-color","white");var d=b/c,e=$("#"+a+"vis").parent();return $(window).on("resize",function(){var a=Math.min(b,e.width());z.attr("width",a),z.attr("height",Math.round(a/d))}).trigger("resize"),z}function k(a){d3.select(this).attr("href","data:image/svg+xml;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(a.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").node().parentNode.innerHTML))))}function l(){z&&k(z)}function m(){d3.select(this).attr("href","data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(B)))))}function n(a,b){d3.selectAll("#"+a.id+b+" li").attr("class",function(){var c=d3.select(this),d=c.select("a");return d.empty()||d.attr("value")!==a[b]?"":"active"})}function o(){d3.event.stopPropagation(),d3.event.preventDefault()}function p(a){var b=d3.select("#"+a+"current-json"),c=d3.select("#"+a+"json");"active"!==b.attr("class")?(b.attr("class","active"),c.text(JSON.stringify(B,null,"	")),c.style("display",null)):(b.attr("class",null),c.text(""),c.style("display","none")),o()}function q(a,b,c){d3.selectAll("#"+a.id+b+" a").on("click",function(){a[b]=d3.select(this).attr("value"),d(a,c),n(a,b),o()})}function r(a,c,d){d3.selectAll("#"+a.id+c+" a").on("click",function(){a[c]=d3.select(this).attr("value"),b||aufschreib.setStatsSilent(a.type,a.mode,a.kind,"all"===a.cat?null:a.cat),d(),n(a,c),o()})}function s(a,b,c){function d(){a[b]=!a[b],this.value=a[b],d3.selectAll("#"+a.id+b).attr("class",a[b]?"active":null),c(),o()}d3.select("#"+a.id+b+" a").on("click",d)}function t(){return A}function u(){return B}function v(a){B=a}function w(a,b){var c='<table class="table table-condensed"><thead><tr>';b.head.forEach(function(a){c+="<th>"+a+"</th>"}),c+="</tr></thead>",b.values.forEach(function(a){c+="<tr>",a.forEach(function(a){c+="<td>"+a+"</td>"}),c+="</tr>"}),b.foot&&(c+="<tfoot>",b.foot.forEach(function(a){c+="<th>"+a+"</th>"}),c+="</tr></tfoot>"),c+="</table>",$("#table").html(c)}function x(b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null}function y(){return a}var z,A=[],B=[];return{getCats:y,getCatInfo:x,getBaseData:t,getData:u,setData:v,initSVG:j,legendary:c,requestData:d,downloadSVG:l,downloadJSON:m,selectActive:n,d3_eventCancel:o,linkUIReloads:g,linkUIRegens:h,selectActives:f,linkUIDefault:e,linkUIReload:q,linkUIRegen:r,linkUIToggles:i,buildTable:w,openSVG:k}}function pieView(){function a(a,b,f,g,h){j=g,p.id=a,p.mode=b,p.kind=f,p.forceregenerate=h,d(),c(),j.requestData(p,e)}function b(){j.requestData(p,e)}function c(){j.linkUIDefault(p.id),j.linkUIReloads(p,["mode"],e),j.linkUIToggles(p,["rated"],e),j.selectActives(p,["mode"])}function d(){k=j.initSVG(p.id,q+t,r),m=k.append("svg:defs");m.append("svg:radialGradient").attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r",u).attr("fx",0).attr("fy",0).attr("id","master");o=k.append("svg:g").attr("class","arcGroup").attr("filter","url(#shadow)").attr("transform","translate("+q/2+","+r/2+")");var a=m.append("filter").attr("id","shadow").attr("filterUnits","userSpaceOnUse").attr("x",-1*(q/2)).attr("y",-1*(r/2)).attr("width",q).attr("height",r);a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","4").attr("result","blur"),a.append("feOffset").attr("in","blur").attr("dx","4").attr("dy","4").attr("result","offsetBlur"),a.append("feBlend").attr("in","SourceGraphic").attr("in2","offsetBlur").attr("mode","normal"),n=d3.layout.pie().sort(null).value(function(a){return a.value}),l=d3.svg.arc().outerRadius(u)}function e(){var a=j.getBaseData();j.setData(a),p.rated&&(a=a.filter(function(a){return"unknown"!==a.id}));var b=m.selectAll(".gradient").data(a,function(a){return a.id}).enter().append("svg:radialGradient").attr("class","gradient").attr("xlink:href","#master");b.attr("id",function(a){return"gradient"+a.id}),b.append("svg:stop").attr("offset","0%").attr("stop-color",f),b.append("svg:stop").attr("offset","90%").attr("stop-color",f),b.append("svg:stop").attr("offset","100%").attr("stop-color",g);var c=o.selectAll("path").data(n(a),function(a){return a.data.id});c.enter().append("svg:path").attr("class","sector");var d=0;a.forEach(function(a){d+=a.value});var e={head:["Bewertung","Prozent","Anzahl"],values:a.map(function(a){return[j.getCatInfo(a.id).name,(100*a.value/d).toFixed(2)+"%",a.value]}),foot:["","100%",d]};j.buildTable("#table",e);var l=0,r=!1;c.attr("fill",function(a){return"url(#gradient"+a.data.id+")"}).attr("title",function(b,c){return"Bewertung:	"+j.getCatInfo(a[c].id).name+"\nProzent:	"+(100*b.value/d).toFixed(2)+"%\nAnzahl:	"+b.value}).transition().duration(600).attrTween("d",i).each("end",function(){l++,r=l==a.length}),c.on("click",function(){}).on("mouseover",function(a){if(r){var b=a.startAngle+(a.endAngle-a.startAngle)/2;b=-1*(b-Math.PI/2);var c=Math.cos(b)*u*.1,d=Math.sin(b)*u*-.1;d3.select(this).transition().duration(250).attr("transform","translate("+c+","+d+")")}}).on("mouseout",function(){r&&d3.select(this).transition().duration(150).attr("transform","translate(0,0)")}),c.exit().transition().duration(1e3).attrTween("d",h).remove(),j.legendary(k,j.getCats(),q,t)}function f(a,b){return j.getCatInfo(j.getData()[b].id).color}function g(a,b){return d3.rgb(f(a,b)).darker()}function h(a){a.startAngle=a.endAngle=2*Math.PI;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return l(b(a))}}function i(a){var b=d3.interpolate({startAngle:0,endAngle:0},a);return this._current=b(0),function(a){return l(b(a))}}var j,k,l,m,n,o,p={type:"pie",mode:"human",kind:null,cat:null,rated:!1,id:"pie_"},q=500,r=500,s=50,t=120,u=Math.min(q-s,r-s)/2;return{init:a,request:b}}function barView(){function a(a,b,d,e){n=e,p.id=a,p.mode=b,p.kind=d,h(),c(),n.selectActives(p,["cat","kind","mode","bars"]),n.requestData(p,i)}function b(){n.requestData(p,i)}function c(){d3.selectAll(".navbar-form input").on("change",f),d3.selectAll("#"+p.id+"bars a").on("click",e),n.linkUIDefault(p.id),n.linkUIReloads(p,["mode","kind"],i),n.linkUIRegens(p,["cat"],i),n.linkUIToggles(p,["hidetag","hidestops","casesensitiv"],i)}function d(){"grouped"===p.bars?l():"stacked"===p.bars&&m()}function e(){p.bars=d3.select(this).attr("value"),d(),n.selectActive(p,"bars"),n.d3_eventCancel()}function f(){isNaN(this.value)||(p.limit=this.value,i()),n.d3_eventCancel()}function g(a){for(var b=[],c={},d=0;d<a.length;d++){var e="_"+a[d].id.toLowerCase();if(c[e]){c[e].count+=a[d].count;for(var f in a[d].counts)c[e].counts[f]=(c[e].counts[f]||0)+a[d].counts[f]}else{c[e]={id:a[d].id.toLowerCase(),count:a[d].count,stop:a[d].stop,counts:{}};for(var f in a[d].counts)c[e].counts[f]=a[d].counts[f]}}for(var f in c)b.push(c[f]);return b}function h(){o=n.initSVG(p.id,q.width(),q.height());var a=o.append("svg:defs"),b=a.append("svg:filter").attr("id","highlight");b.append("svg:feGaussianBlur").attr("stdDeviation",3),r.graphcontainer=o.append("g").attr("transform","translate("+q.margins.left+","+q.margins.top+")"),r.graphcontainer.append("g").attr("class","xaxis").attr("transform","translate(10,"+(q.barheight-34)+")"),r.graphcontainer.append("g").attr("class","y axis"),r.x=d3.scale.ordinal().rangeRoundBands([0,q.barwidth],.08),r.y=d3.scale.linear().range([q.barheight,0]),r.xAxis=d3.svg.axis().tickSize(0).orient("bottom"),r.yAxis=d3.svg.axis().tickSize(q.barwidth).orient("right")}function i(){var a;a=p.casesensitiv?n.getBaseData():g(n.getBaseData()),p.hidestops&&(a=a.filter(function(a){return!a.stop})),p.hidetag&&(a=a.filter(function(a){return"#aufschrei"!==a.id&&"#Aufschrei"!==a.id}));for(var b=[],c=0;c<a.length;c++)if("all"===p.cat)b.push(a[c]);else if(a[c].counts[p.cat]>0){var e=p.cat,f={id:a[c].id,count:a[c].counts[e],counts:{}};f.counts[e]=a[c].counts[e],b.push(f)}b.sort(function(a,b){return b.count-a.count}),b=b.splice(0,500);var h={head:[p.kind,"Anzahl"].concat("all"===p.cat?n.getCats().map(function(a){return'<i title="'+a.name+'" class="glyphicon '+a.icon+'"></i>'}):[]),values:b.map(function(a){var b=[a.id,a.count];return"all"===p.cat&&n.getCats().forEach(function(c){b.push(a.counts[c.id]||0)}),b})};n.buildTable("#table",h),p.limit>0&&(b=b.splice(0,p.limit)),n.setData(b),r.catsInView=[];var i=[];b.forEach(function(a){for(var b in a.counts)i.indexOf(b)<0&&(i.push(b),r.catsInView.push(n.getCatInfo(b)))});var l=d3.layout.stack(),m=d3.range(r.catsInView.length).map(function(a,c){for(var d=r.catsInView[a].id,e=[],f=0;f<b.length;f++)e[f]=b[f].counts[d]||0;return e.map(function(a,d){return{x:d,y:a,layer:c,total:b[d].count}})}),o=[];m.length>0&&(o=l(m)),r.yGroupMax=d3.max(o,function(a){return d3.max(a,function(a){return a.y})}),r.yStackMax=d3.max(o,function(a){return d3.max(a,function(a){return a.y0+a.y})}),r.x.domain(d3.range(b.length)),r.y.domain([0,r.yStackMax]),r.xAxis.scale(r.x).tickFormat(function(a){return b[a].id}),r.yAxis.scale(r.y),r.graphcontainer.selectAll(".xaxis").call(r.xAxis).call(j),r.graphcontainer.selectAll(".y.axis").call(r.yAxis).call(k);var s=r.graphcontainer.selectAll(".layer").data(o).enter().append("g").attr("class","layer");s=r.graphcontainer.selectAll(".layer"),s.data(o).exit().remove(),s=r.graphcontainer.selectAll(".layer"),s.style("fill",function(a,b){return r.catsInView[b].color}),r.rect=s.selectAll(".segment").data(function(a){return a}).enter().append("rect").attr("class","segment").attr("y",q.barheight).attr("height",0),r.rect=s.selectAll(".segment"),r.rect.attr("title",function(a,c){return"Klasse:		"+r.catsInView[a.layer].name+"\nEintrag:		"+b[c].id+"\nAnzahl:		"+a.y+"\n"+(a.y===a.total?"":"Insgesamt: 	"+a.total)}),d(),n.legendary(r.graphcontainer,r.catsInView,q.barwidth-q.legendwidth,q.legendwidth)}function j(a){a.selectAll("text").attr("style","text-anchor:end;").attr("transform",function(){return"rotate(-45)translate("+-2*this.getBBox().height+","+this.getBBox().height+")"})}function k(a){a.selectAll("text").attr("x",-4).attr("style","text-anchor:end;")}function l(){r.y.domain([0,r.yGroupMax]),r.rect.transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a){return r.x(a.x)+r.x.rangeBand()/r.catsInView.length*a.layer}).attr("width",r.x.rangeBand()/r.catsInView.length).transition().attr("y",function(a){return r.y(a.y)}).attr("height",function(a){return q.barheight-r.y(a.y)})}function m(){r.y.domain([0,r.yStackMax]),r.rect.transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return r.y(a.y0+a.y)}).attr("height",function(a){return r.y(a.y0)-r.y(a.y0+a.y)}).transition().attr("x",function(a){return r.x(a.x)}).attr("width",r.x.rangeBand())}var n,o,p={type:"bar",mode:"human",kind:"word",cat:"all",hidestops:!0,hidetag:!0,bars:"stacked",casesensitiv:!1,limit:30,id:"bars_"},q={legendwidth:120,margins:{top:40,right:10,bottom:20,left:80},xaxisheight:150,barheight:300,barwidth:1e3,width:function(){return this.barwidth+this.margins.left+this.margins.right},height:function(){return this.barheight+this.xaxisheight+this.margins.top+this.margins.bottom}},r={catsInView:null,graphcontainer:null,yGroupMax:null,yStackMax:null,rect:null,x:null,y:null,xAxis:null,yAxis:null};return{init:a,request:b}}function graphView(){function a(a,b,c,f){h=f,k.id=a,k.mode=b,k.kind=c,d(),h.requestData(k,e)}function b(){h.requestData(k,e)}function c(){isNaN(this.value)||(k.min=this.value,e()),h.d3_eventCancel()}function d(){d3.selectAll(".navbar-form input").on("change",c),h.linkUIDefault(k.id),h.linkUIReloads(k,["mode","kind"],e),h.linkUIRegens(k,["view"],e),$("#"+k.id+"download-svg").hide(),h.selectActives(k,["view","mode","kind"])}function e(){var a=h.getBaseData();g(a)}function f(a){return h.getCatInfo(a).color}function g(a){j&&j.pause(),i&&i.clear(),$("#"+k.id+"vis").html(""),i=Viva.Graph.graph();var b={};a.links.forEach(function(c){c.value>=k.min&&(b[c.source]||(b[c.source]=!0,i.addNode(c.source,a.nodes[c.source])),b[c.target]||(b[c.target]=!0,i.addNode(c.target,a.nodes[c.target])),i.addLink(c.source,c.target))}),h.setData(a);var c;if("svg"===k.view){var d=8;c=Viva.Graph.View.svgGraphics(),c.node(function(a){var b=f(a.data.vote),c=Viva.Graph.svg("rect").attr("width",d).attr("height",d).attr("stroke",b).attr("fill",b);return c.append("title").text(a.data.name+"\nMostly: "+h.getCatInfo(a.data.vote).name),c})}else c=Viva.Graph.View.webglGraphics();j=Viva.Graph.View.renderer(i,{graphics:c,renderLinks:!0,container:document.getElementById(k.id+"vis"),prerender:!0}),j.run()}var h,i,j,k={type:"graph",mode:"human",kind:"mention",cat:null,min:5,view:"svg",id:"graph_"};return{init:a,request:b}}function hashtagsView(){function a(a,c,g,h){stats=h,f.id=a,f.mode=c,f.kind=null,d(),e(),b()}function b(){stats.requestData(f,c)}function c(){var a=stats.getBaseData();a.length>0&&(a[0].disabled=!1),stats.setData(a),h.datum(a).call(g),nv.utils.windowResize(function(){g.update()})}function d(){h=d3.select("#"+f.id+"vis").append("svg");var a=(d3.time.format("%d"),d3.time.format("%H"),d3.time.format("%d.%m %Hh")),b=function(b){return b=new Date(b),a(b)};g=nv.models.lineWithFocusChart(),g.xAxis.ticks(d3.time.hours).tickFormat(b),g.x2Axis.ticks(d3.time.days).tickFormat(b)}function e(){stats.linkUIDefault(f.id),stats.linkUIReloads(f,["mode"],b),stats.linkUIRegens(f,["cat"],b),stats.selectActives(f,["mode","cat"])}var f={type:"hashtags",mode:"human",cat:"all",kind:null,id:"hashtags_"},g=null,h=null;return{init:a,request:b}}function timeView(){function a(a,b,f,h){g=h,w.id=a,w.mode=b,w.kind=""===f?null:f,c(),d(),g.selectActives(w,["mode","view"]),g.requestData(w,e)}function b(){g.requestData(w,e)}function c(){h=g.initSVG(w.id,B+x.left+x.right,C),s=d3.time.scale().range([0,B]),t=d3.time.scale().range([0,B]),u=d3.scale.linear().range([D,0]),v=d3.scale.linear().range([y,0]),i=d3.svg.area().interpolate("monotone").x(function(a){return s(a.x)}).y0(function(a){return u(a.y0)}).y1(function(a){return u(a.y0+a.y)}),j=d3.svg.area().interpolate("cardinal").x(function(a){return t(a.x)}).y0(function(a){return v(a.y0)}).y1(function(a){return v(a.y0+a.y)}),m=h.append("g").attr("transform","translate("+x.left+","+x.top+")"),n=h.append("g").attr("transform","translate("+x.left+","+(x.top+D+z)+")"),k=m.append("g"),l=n.append("g"),r=d3.svg.brush().x(t).on("brush",f),h.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",B).attr("height",C);var a=d3.time.format("%d"),b=d3.time.format("%H"),c=d3.time.format("%a %d"),d=function(a){return 0===a.getHours()?c(a):b(a)};o=d3.svg.axis().scale(s).orient("bottom").ticks(d3.time.hours).tickFormat(d),p=d3.svg.axis().scale(t).orient("bottom").ticks(d3.time.days).tickFormat(a),q=d3.svg.axis().scale(u).orient("left"),m.append("g").attr("class","x axis").attr("transform","translate(0,"+D+")").call(o),n.append("g").attr("class","x axis focus").attr("transform","translate(0,"+y+")").call(p);var e=m.append("g");e.append("rect").attr("class","fillrect").attr("x",B).attr("y",0).attr("width",200).attr("height",D),e=m.append("g").attr("class","y axis"),e.append("rect").attr("class","fillrect").attr("x",-200).attr("y",0).attr("width",200).attr("height",D),e.call(q),n.append("g").attr("class","x brush").call(r).selectAll("rect").attr("height",y)}function d(){g.linkUIDefault(w.id),g.linkUIReloads(w,["mode"],e),g.linkUIRegens(w,["view"],e)}function e(){var a=g.getBaseData();g.setData(a);var b=[],c=[],d={},e=a[0].time,f=a[0].time;a.forEach(function(a){for(var h in a.counts)c.indexOf(h)<0&&(c.push(h),b.push(g.getCatInfo(h)));a.time=parseInt(a.time),d[a.time]=a,e=Math.min(e,a.time),f=Math.max(f,a.time)});for(var x=e;f>x;x+=36e5)d[x]||a.push({time:x,count:0,counts:{}});a.sort(function(a,b){return a.time<b.time?-1:a.time>b.time?1:0});var y=d3.layout.stack().offset(w.view),z=d3.range(b.length).map(function(c){var d=b[c].id;return a.map(function(a){return{x:a.time,y0:0,y:a.counts[d]||0}})}),C=y(z),D=d3.max(C,function(a){return d3.max(a,function(a){return a.x})}),F=d3.min(C,function(a){return d3.min(a,function(a){return a.x})}),G=d3.max(C,function(a){return d3.max(a,function(a){return a.y0+a.y})}),H=Math.min(F+E,D);s.domain([F,H]),t.domain([F,D]),u.domain([0,G]),v.domain([0,G]),m.select(".x.axis").call(o),m.select(".y.axis").call(q),n.select(".x.axis").call(p),k.selectAll(".layer").data(C).enter().append("path").attr("class","layer"),k.selectAll(".layer").data(C).transition().duration(500).attr("d",function(a){return i(a)}).style("fill",function(a,c){return b[c].color}).attr("title",function(a,c){return b[c].name}),l.selectAll(".focuslayer").data(C).enter().append("path").attr("class","focuslayer").attr("clip-path","url(#clip)"),l.selectAll(".focuslayer").transition().duration(500).attr("d",function(a){return j(a)}).style("fill",function(a,c){return b[c].color}).attr("title",function(a,c){return b[c].name}),m.select(".y.axis").style("display","zero"===w.view?null:"none"),h.select(".brush").call(r.extent([F,H])),g.legendary(h,b,B-A,A)}function f(){s.domain(r.empty()?t.domain():r.extent()),k.selectAll("path").attr("d",i),m.select(".x.axis").call(o)}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w={type:"time",mode:"human",cat:"all",kind:null,id:"times_",view:"zero"},x={top:20,right:30,bottom:30,left:80},y=80,z=50,A=120,B=1300-x.left-x.right,C=500,D=C-z-x.top-x.bottom-y,E=864e5;return{init:a,request:b}}var aufschreib={data:["human_unknown","machine_unknown","machine_outcry","machine_report","machine_comment","machine_troll","machine_spam"],search:"",def_range:{min:null,max:null},range:{min:null,max:null},range_enabled:!1,stats:{mode:"human",type:"pie",cat:null,kind:null},current:"",connected:!1,connectedlog:"",connectedloghistory:"",closethings:!1,route:{"default":"start",hash:"",subs:[]},error:function(a){$("#alert").remove(),$("body").prepend($('<div id="alert" class="alert alert-danger"><button data-dismiss="alert" class="close" type="button">×</button><h4 class="alert-heading">Oh snap! You got an error!</h4><p>'+a+"</p></div>"))},blendProgressIn:function(a){a?($("#overlay-inline").remove(),$(a).prepend('<div id="overlay-inline"><div class="overlay-img"></div></div>'),$("#overlay-inline").fadeIn("fast")):$("#overlay").fadeIn("fast")},blendProgressOut:function(a){a&&$("#overlay-inline").remove(),a||$("#overlay").fadeOut("fast")},getJson:function(a,b,c){var d=setTimeout(function(){aufschreib.blendProgressIn(a)},2e3);$.ajax({url:"",dataType:"json",data:b,success:function(b){clearTimeout(d),aufschreib.blendProgressOut(a),c(b)},error:function(b,c,e){clearTimeout(d),aufschreib.blendProgressOut(a),aufschreib.error(b.status+": "+e)}})},get:function(a,b,c,d){if(a)var e=setTimeout(function(){aufschreib.blendProgressIn(a)},2e3);$.ajax({url:b,dataType:"html",data:c,success:function(b){clearTimeout(e),a&&aufschreib.blendProgressOut(a),d(b)},error:function(b,c,d){clearTimeout(e),a&&aufschreib.blendProgressOut(a),aufschreib.error(b.status+": "+d)}})},loadMore:function(a){var b=$("#"+a),c={cmd:"user",id:a};return aufschreib.get(b,"",c,function(a){var c=$(b).parent();$(b).replaceWith(a),aufschreib.connectCatChange(c)}),!1},checkVoted:function(a){var b=$(a).find(".tweet"),c=$(a).find("a[class*=active]");return b.length==c.length&&$(a).closest(".user").remove(),aufschreib.checkNext(),!1},checkNext:function(){var a=$(".user");0===a.length&&$("#btn-next").click()},setActiveCat:function(a,b){a.find("a[class*=active]").removeClass("active").removeClass("btn-primary"),a.find("a[value*="+b+"]").addClass("active").addClass("btn-primary"),b&&"unknown"!=b&&""!=b?a.find(".tweet-classy").addClass("hidden"):a.find(".tweet-classy").removeClass("hidden")},voteTweet:function(a,b){var c=$(a).closest(".tweet"),d=$(c).attr("id"),e={cmd:"set",id:d,cat:b};return aufschreib.get(c,"",e,function(d){d&&(aufschreib.setActiveCat(c,b),aufschreib.closethings&&aufschreib.checkVoted($(a).closest(".user")))}),!1},voteIds:function(a,b,c,d){var e={cmd:"setall",ids:b.join(","),cat:d};aufschreib.get(a,"",e,function(b){b&&(c.forEach(function(a){aufschreib.setActiveCat(a,d)}),aufschreib.closethings&&aufschreib.checkVoted(a))})},voteAll:function(a,b){var c=[],d=[],e=$(a).closest(".user");$(e).find("div[class=tweet]").each(function(){d.push($(this)),c.push($(this).attr("id"))});for(var f=d.splice(0,100),g=c.splice(0,100);g.length>0;)aufschreib.voteIds(e,g,f,b),f=d.splice(0,100),g=c.splice(0,100);return!1},connectCatChange:function(a){$(a).find(".btn-tweet").each(function(){$(this).unbind("click"),$(this).click(function(){var a;return a=$(this).hasClass("active")?"unknown":$(this).attr("value"),aufschreib.voteTweet(this,a),!1})}),$(a).find(".tweet-close").each(function(){$(this).unbind("click"),$(this).click(function(){var a=$(this).closest(".user");return $(a).find(".tweet").length<=1?$(a).remove():$(this).closest(".tweet").remove(),!1})}),$(a).find(".user-close").each(function(){$(this).unbind("click"),$(this).click(function(){return $(this).closest(".user").remove(),aufschreib.checkNext(),!1})}),$(a).find(".btn-user").each(function(){$(this).unbind("click"),$(this).click(function(){return aufschreib.voteAll(this,$(this).attr("value")),!1})})},makeListParams:function(){var a={cmd:"list",filter:aufschreib.data.join(",")};return aufschreib.search.length>0&&(a.search=encodeURIComponent(aufschreib.search)),aufschreib.range_enabled&&aufschreib.range.min&&aufschreib.range.max&&(a.rangegte=aufschreib.range.min.valueOf(),a.rangelte=aufschreib.range.max.valueOf()),a},nextList:function(a){$(a).addClass("disabled"),$(a).html('<div class="process-img"></div> <span>Lade die nächsten Tweets...</span>');var b=$(a).attr("value"),c=aufschreib.makeListParams();return c.id=b,aufschreib.get(null,"",c,function(b){var c=$(a).parent();$(a).replaceWith(b),aufschreib.connectCatChange(c)}),!1},applyfilter:function(){$('#modal-filter input[type="checkbox"]').each(function(){var a=$.inArray($(this).attr("value"),aufschreib.data);$(this).attr("checked")?0>a&&aufschreib.data.push($(this).attr("value")):a>=0&&aufschreib.data.splice(a,1)})},clearContent:function(){$("#content").html('<div style="width:100%; height:200px;"><div class="overlay-img"></div></div>')},request:function(){aufschreib.clearContent(),aufschreib.current="vote";var a=aufschreib.makeListParams();return aufschreib.get(null,"",a,function(a){if("vote"==aufschreib.current){var b=$(".content");b.html(a),aufschreib.connectCatChange(b)}}),!1},requestStart:function(){aufschreib.clearContent(),aufschreib.current="start";var a={cmd:"start"};return aufschreib.get(null,"",a,function(a){"start"==aufschreib.current&&$("#content").html(a)}),!1},requestCommands:function(){aufschreib.clearContent(),aufschreib.current="commands";var a={cmd:"commands"};return aufschreib.get(null,"",a,function(a){"commands"==aufschreib.current&&($("#content").html(a),aufschreib.setProcessing(aufschreib.connected,aufschreib.connectedlog))}),!1},requestChart:function(){aufschreib.clearContent(),aufschreib.current="charts",$("li","#nav-stats").removeClass("active"),$("a[href*="+aufschreib.stats.type+"]","#nav-stats").parent().addClass("active");var a={cmd:"chart",type:aufschreib.stats.type,mode:aufschreib.stats.mode};return aufschreib.stats.cat&&(a.cat=aufschreib.stats.cat),aufschreib.stats.kind&&(a.kind=aufschreib.stats.kind),aufschreib.get(null,"",a,function(a){"charts"==aufschreib.current&&$("#content").html(a)}),!1},connectIo:function(a,b,c){var d=window.location.protocol+"//"+window.location.host,e=io.connect(d).emit("start",{cmd:a}).on("news",function(a){var c=a.msg+"<br />";aufschreib.connectedloghistory+=c,$(b).append(c)}).on("success",function(a){e.emit("end",{}),e.disconnect(),io.j=[],io.sockets=[],c(a.msg)}).on("connect_failed",function(){c("Connection error. Please reload site."),io.j=[],io.sockets=[]}).on("fail",function(a){e.disconnect();var c=a.msg+"<br />";aufschreib.connectedloghistory+=c,$(b).append(c)})},requestClassify:function(){return aufschreib.setProcessing(!0,"#classify-result"),aufschreib.connectIo("classify","#classify-result",function(a){aufschreib.setProcessing(!1),$("#classify-result").html(a)}),!1},classify:function(){return aufschreib.connected||$("#command-modal").modal("show"),!1},setProcessing:function(a,b){aufschreib.connected=a,aufschreib.connectedlog=b,a?($("[id^='btn-act-']").addClass("disabled"),$(aufschreib.connectedlog).html('<div class="process-img"></div> Vorgang läuft...<br />'+aufschreib.connectedloghistory)):($("[id^='btn-act-']").removeClass("disabled"),aufschreib.connectedloghistory="")},updateCache:function(){return aufschreib.connected?!1:(aufschreib.setProcessing(!0,"#statcache-result"),aufschreib.connectIo("updatecache","#statcache-result",function(a){aufschreib.setProcessing(!1),$("#statcache-result").html(a)}),!1)},createUser:function(){if(aufschreib.connected)return!1;var a=$("#form-newuser").serialize();return aufschreib.setProcessing(!0,"#output-newuser"),$.ajax({url:"/user/create",type:"POST",data:a,success:function(){aufschreib.setProcessing(!1),$("#output-newuser").text("User created!")},error:function(a,b){aufschreib.setProcessing(!1),$("#output-newuser").text("Error "+b)}}),!1},sendFile:function(a){if(aufschreib.connected||!a)return!1;var b=$("#bulkfile").val();return b&&0!==b.trim().length&&/\.(json)$/gi.test(b)?(aufschreib.setProcessing(!0,"#output-upload"),$("#form-file").ajaxSubmit({target:"#output-upload",data:{user:a},success:function(){aufschreib.setProcessing(!1)}}),!1):($("#output-upload").text("Please choose a .json file!"),!1)},setMode:function(a){$("li","#nav-site").removeClass("active"),$("a[href*="+a+"]","#nav-site").parent().addClass("active"),$("#nav-edit").toggle("edit"===a),"stats"==a||"edit"==a&&aufschreib.range_enabled?$("#time-filter-pane").is(":hidden")&&($("#time-filter-pane").toggle(!0),$("#slider").dateRangeSlider("resize"),$("#slider").dateRangeSlider("values",aufschreib.range.min,aufschreib.range.max)):$("#time-filter-pane").toggle(!1),$("#nav-stats").toggle("stats"===a)},setStatsSilent:function(a,b,c,d){aufschreib.stats.type=a,aufschreib.stats.mode=b,aufschreib.stats.kind=c,aufschreib.stats.cat=d;var e="!/stats/"+aufschreib.stats.type+"/"+aufschreib.stats.mode+(aufschreib.stats.kind?"/"+aufschreib.stats.kind:"")+(aufschreib.stats.cat?"/"+aufschreib.stats.cat:"");aufschreib.route.hash="#"+e,location.hash=e},routeStats:function(a){a.length>0?aufschreib.stats.type=a[0]:aufschreib.stats.type||(aufschreib.stats.type="pie"),a.length>1?aufschreib.stats.mode=a[1]:aufschreib.stats.mode||(aufschreib.stats.mode="human"),aufschreib.stats.kind=null,a.length>2?aufschreib.stats.kind=a[2]:"cloud"===aufschreib.stats.type||"bar"===aufschreib.stats.type?aufschreib.stats.kind||(aufschreib.stats.kind="word"):"graph"===aufschreib.stats.type?aufschreib.stats.kind||(aufschreib.stats.kind="mention"):aufschreib.stats.kind=null,a.length>3?aufschreib.stats.cat=a[3]:"cloud"!==aufschreib.stats.type&&"bar"!==aufschreib.stats.type&&(aufschreib.stats.cat=null);var b="!/stats/"+aufschreib.stats.type+"/"+aufschreib.stats.mode+(aufschreib.stats.kind?"/"+aufschreib.stats.kind:"")+(aufschreib.stats.cat?"/"+aufschreib.stats.cat:"");return location.hash!=="#"+b?(location.hash=b,!1):(aufschreib.setMode("stats"),aufschreib.requestChart(),!0)},routeCommand:function(){return aufschreib.setMode("commands"),aufschreib.requestCommands(),!0},routeEdit:function(){return aufschreib.setMode("edit"),aufschreib.request(),!0},routeStart:function(){return aufschreib.setMode("start"),aufschreib.requestStart(),!0},router:function(){if(""===location.hash||location.hash!==aufschreib.route.hash){if(""===location.hash&&aufschreib.route.hash==="#!/"+aufschreib.route.default)return location.hash="!/"+aufschreib.route.default,!1;aufschreib.route.hash=location.hash;var a=location.hash.split("/");if(a.length>0){for(var b=[],c=0;c<a.length;c++)"#!"!==a[c]&&b.push(a[c].toLowerCase());switch(0===b.length&&b.push("edit"),aufschreib.route.subs=b,b[0]){case"stats":b.shift(),aufschreib.routeStats(b);break;case"commands":b.shift(),aufschreib.routeCommand();break;case"edit":b.shift(),aufschreib.routeEdit();break;case"start":b.shift(),aufschreib.routeStart();break;default:location.hash="!/"+aufschreib.route.default}}else location.hash="!/"+aufschreib.route.default}return!1},load:function(){$(document).ready(function(){aufschreib.ready(),aufschreib.router()})},ready:function(){$("#menu").show();var a=$("#search");a.keypress(function(a){13==a.which&&(aufschreib.search=this.value,aufschreib.request())}),aufschreib.def_range.min=new Date(parseInt($("#slider").attr("min"))),aufschreib.def_range.max=new Date(parseInt($("#slider").attr("max"))),aufschreib.range.min=aufschreib.def_range.min,aufschreib.range.max=aufschreib.def_range.max,$("#slider").dateRangeSlider({defaultValues:aufschreib.def_range,bounds:aufschreib.def_range,formatter:function(a){return moment(a).format("MMM D, HH:mm")},scales:[{first:function(a){return a},end:function(a){return a},next:function(a){return moment(a).add("days",1)},label:function(a){return moment(a).date()}}]}),$("#slider").bind("valuesChanged",function(a,b){$("#time-filter-pane").is(":visible")&&(aufschreib.range.min=b.values.min,aufschreib.range.max=b.values.max,$("#count_edit_min").datetimepicker({value:moment(b.values.min).format("DD.MM.YY HH:mm")}),$("#count_edit_max").datetimepicker({value:moment(b.values.max).format("DD.MM.YY HH:mm")}),"vote"==aufschreib.current?aufschreib.request():aufschreib.statsrequest&&aufschreib.statsrequest())}),$(".poi-link").click(function(){var a=new Date(parseInt($(this).attr("min"))),b=new Date(parseInt($(this).attr("max")));aufschreib.range.min=a,aufschreib.range.max=b,$("#slider").dateRangeSlider("values",a,b)}),$("#count_edit_min").datetimepicker({format:"d.m.y H:i",value:moment(aufschreib.range.min).format("D.MM.YY HH:mm"),onChangeDateTime:function(a){aufschreib.range.min.valueOf()!==a.valueOf()&&(aufschreib.range.min=a,$("#slider").dateRangeSlider("values",a,aufschreib.range.max))}}),$("#count_edit_max").datetimepicker({format:"d.m.y H:i",value:moment(aufschreib.range.min).format("D.MM.YY HH:mm"),onChangeDateTime:function(a){aufschreib.range.max.valueOf()!==a.valueOf()&&(aufschreib.range.max=a,$("#slider").dateRangeSlider("values",aufschreib.range.min,a))}}),$("#time-filter-toggle a").click(function(a){aufschreib.range_enabled=!aufschreib.range_enabled,$("#time-filter-toggle").toggleClass("active",aufschreib.range_enabled),$("#time-filter-pane").toggle(aufschreib.range_enabled),aufschreib.range_enabled&&($("#slider").dateRangeSlider("resize"),$("#slider").dateRangeSlider("values",aufschreib.range.min,aufschreib.range.max)),aufschreib.request(),a.stopPropagation()
}),a.val(aufschreib.search),$(".dropdown li").click(function(a){a.stopPropagation()}),$("#option_hideaftervote").click(function(){return aufschreib.closethings="checked"===$(this).attr("checked"),!0}),aufschreib.closethings="checked"===$("#option_hideaftervote").attr("checked"),$("#modal-filter a.check_all").click(function(a){return $('#modal-filter input[type="checkbox"]').attr("checked","checked"),a.stopPropagation(),!1}),$("#modal-filter a.check_none").click(function(a){return $('#modal-filter input[type="checkbox"]').attr("checked",null),a.stopPropagation(),!1}),$("#modal-filter a.check_apply").click(function(){aufschreib.applyfilter(),aufschreib.request()}),aufschreib.applyfilter(),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=aufschreib.router:setInterval(function(){aufschreib.router()},100)}};$("#jswarning").remove(),aufschreib.load();